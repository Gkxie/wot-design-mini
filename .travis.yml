sudo: false
language: node_js
branches:
  only:
    - /^v\d+\.\d+\.\d+/
node_js:
  - "12"
install:
  - npm install
script:
  - npm run build:icon
  - npm run build
  - npm run build:wx
  - npm run build:docs
before_deploy:
  # get release text
  - npm i markdown-it
  - export RELEASE_NAME=$(git describe --tags $(git rev-list --tags --max-count=1))
  - export RELEASE_NOTE=$(node build/deploy/change-log.js --path=docs/docs/changelog.md)
  # get release file
  - mv lib wot-design
  - zip -r wot-design-$RELEASE_NAME-jd.zip wot-design/*
  - mv wot-design lib
  - mv lib-wx wot-design
  - zip -r wot-design-$RELEASE_NAME-wechat.zip wot-design/*
  - mv wot-design lib-wx
deploy:
  provider: <releases>
  # â‹®
  edge: true
  skip_cleanup: true
  overwrite: true
  api_key:
    secure: Umw8SWiwAhKcgY15JoQGdbFdFjuqf937p7Q0VU3O+OTcJ6/0Sa/T6T1tGkUt/jr4Dd5irWpmBNgaykSbnciXyV0cvJqcTlxuU6TVSo6aX4134c75v++/o1CpurtTHSm4zM1HqbOZAUECJqy5yCaYDujpeRTDeH7tyPeEgQ+uiPFx0XhLolDZIs2iwvc3rVv1Om+BMgG4/qBXopUhkuR94WQPgkDJll5ksYCpqUujWFz69q3X/VJLWAG/YRdCWTp6cxABbAJ+9gTLkjGiDqHrqyv2eCJIay6JTLraXMQzeaHagTJQCF/37Vat8PewTW6axiAsgyx9VNrqP4mcBDmREkoetMakhJ6fRENcFEQzpowOXqIJlg+LuB4AvXRVMjd0gUjRUvwo8NT8t132/Z5IK8RPKscertHg450Yku9ZWXawkLUCyMD1CmlWpDCkZtQtUrNinwTSF0doNhcIP+FMtNdzxwhPnSG8biFKSJYy4796eGquUwnicZHTme5SIhnvu6ZNEWrIK6WvPAnOzNIqAPxHD5laTnbgJMUuurNGkORGrlGHN4rhC1pkWy8OoO4lZmNeWEh3th7iXAtn+BMy1eiemHg03SrrEZgw5LiInINiBDRAGTZe03vxKv4Epb7w5kdknNouHwtXTMDKzDpyE59RFIzaUAGHry5UaIUY/1A=
  name: $RELEASE_NAME
  release_notes: $RELEASE_NOTE
  file_glob: true
  file: ./*.zip
  draft: false
  prerelease: false
  on:
    tags: true
after_deploy:
  - sh ./build/deploy/deploy-docs.sh